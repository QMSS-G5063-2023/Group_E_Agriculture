---
title: "Final Scratch Work"
output: html_document
date: "2023-04-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(emoji)
library(dplyr)
library(ggimage)
library(emojifont)
library(shiny)
library(shinydashboard)
library(ggplot2)
library(stringr)
library(forcats)
library(dplyr)
library(plotly)
library(highcharter)
library(DT)
library(tidyverse)
library(leaflet)
library(RColorBrewer)
library(leaflegend)
library(sf)
library(usmap)
library(ggplot2)
library(maps)
library(ggthemes)
library(readxl)
library(stringr)
library(urbnmapr)


```


### Loading data
```{r}
price <- read.csv("data/CPI_Data/ap.data.3.Food.csv")
price_code <- read.csv("data/CPI_Data/ap.item.csv")
usda <- read.csv("data/USDA_Data/annual_crop_yield_and_price_2002-2023.csv")

# merge in CPI descriptions with CPI data
price$item_code <- price$series_id
price$item_code <- gsub("APU0000",'',price$item_code)
price$item_code <- gsub("APU0100",'',price$item_code)
price$item_code <- gsub("APU0200",'',price$item_code)
price$item_code <- gsub("APU0300",'',price$item_code)
price$item_code <- gsub("APU0400",'',price$item_code)

price <- merge(price, price_code, by="item_code")



```


### production yearly plot

```{r}
#
usda$Value_numeric <- as.numeric(gsub(",","",usda$Value))


make_production_plot <- function(food,variable,fruit_veg,color,color2){
  filter(usda, Data.Item == variable) %>% 
  ggplot() + 
    geom_line(aes(x=Year, y = Value_numeric), color=color2,size=.5) +
    geom_point(aes(x=Year, y = Value_numeric), color=color2, size=.5) +
    geom_text(label = emoji(fruit_veg),  size=6.5,family="EmojiOne",color=color,aes(x=Year, y = Value_numeric)) +
   # gg_image(aes(image= fruit_veg))
    labs(x="Year",y="Production (tons)",title=food) 

}

make_production_plot("Apple","APPLES - PRODUCTION, MEASURED IN TONS","apple","red","pink")
make_production_plot("Pear","PEARS - PRODUCTION, MEASURED IN TONS","pear", "#255328","#82F789")
make_production_plot("Grape","GRAPES - PRODUCTION, MEASURED IN TONS","grapes", "#255328","#82F789")
```


### state level data a

```{r}

#read in state files
state1 <- read.csv("data/USDA_Data/state_usda_2022_2011.csv")
state2 <- read.csv("data/USDA_Data/state_usda_2010_2002.csv")
usda_state <- rbind(state1, state2)

#make state map
usstate_sf <- get_urbn_map("states", sf = TRUE)
usstate_sf["State"] <- usstate_sf["state_name"]
usstate_sf["State"] <- toupper(usstate_sf$"State")

#make file with geometry data
usda_state_maps <- merge(usstate_sf,usda_state,by="State")
#st_transform(usda_state_maps, "+proj=longlat +datum=WGS84")

usda_state_maps$Value_numeric <- as.numeric(gsub(",","",usda_state_maps$Value))



```


```{r}
#when only filter in making the plot, it only includes 26 states and that is making the map strange. 

peaches_2017 <- filter(usda_state, Data.Item == "PEACHES - PRODUCTION, MEASURED IN TONS",Year == "2017")
peaches_2017_map <- merge(usstate_sf,peaches_2017,by="State",all=TRUE)
peaches_2017_map$Value_numeric <- as.numeric(gsub(",","",peaches_2017_map$Value))

  ggplot() + 
  #geom_sf(data = usstate_sf , fill = NA, color = "#EEEEEE", size = 1) + 
  geom_sf(data = peaches_2017_map, color="#EEEEEE", aes(fill = Value_numeric)) +
  scale_fill_continuous(name = "Peaches Produced (tons)", label = scales::comma, low = "orange", high = "pink",na.value="#EEEEEE") + 
  theme_map() + 
  theme(legend.position = "right") + 
  labs(title = "Tons of Peaches Produced in 2017 by State") 
  
broccoli_2017 <- filter(usda_state, Data.Item == "BROCCOLI - PRODUCTION, MEASURED IN CWT",Year == "2017")
broccoli_2017_map <- merge(usstate_sf,broccoli_2017,by="State",all=TRUE)
broccoli_2017_map$Value_numeric <- as.numeric(gsub(",","",broccoli_2017_map$Value))

  ggplot() + 
  #geom_sf(data = usstate_sf , fill = NA, color = "#EEEEEE", size = 1) + 
  geom_sf(data = broccoli_2017_map, color="#EEEEEE", aes(fill = Value_numeric)) +
  scale_fill_continuous(name = "Broccoli Produced (CWT)", label = scales::comma, low = "green", high = "#023020",na.value="#EEEEEE") + 
  theme_map() + 
  theme(legend.position = "right") + 
  labs(title = "CWT of Broccoli Produced in 2017 by State") 
  
  
  
apple_2017 <- filter(usda_state, Data.Item == "APPLES - PRODUCTION, MEASURED IN LB",Year == "2017")
apple_2017_map <- merge(usstate_sf,apple_2017,by="State",all=TRUE)
apple_2017_map$Value_numeric <- as.numeric(gsub(",","",apple_2017_map$Value))

  ggplot() + 
  #geom_sf(data = usstate_sf , fill = NA, color = "#EEEEEE", size = 1) + 
  geom_sf(data = apple_2017_map, color="#EEEEEE", aes(fill = Value_numeric)) +
  scale_fill_continuous(name = "Apple Produced (LB)", label = scales::comma, low = "green", high = "red",na.value="#EEEEEE") + 
  theme_map() + 
  theme(legend.position = "right") + 
  labs(title = "Pounds of Apple Produced in 2017 by State") 
  
  
  orange_2017 <- filter(usda_state, Data.Item == "ORANGES, MID & NAVEL, UTILIZED - PRODUCTION, MEASURED IN TONS",Year == "2017")
orange_2017_map <- merge(usstate_sf,orange_2017,by="State",all=TRUE)
orange_2017_map$Value_numeric <- as.numeric(gsub(",","",orange_2017_map$Value))

  ggplot() + 
  #geom_sf(data = usstate_sf , fill = NA, color = "#EEEEEE", size = 1) + 
  geom_sf(data = orange_2017_map, color="#EEEEEE", aes(fill = Value_numeric)) +
  scale_fill_continuous(name = "Mid & Navel Oranges Produced (tons)", label = scales::comma, low = "yellow", high = "red",na.value="#EEEEEE") + 
  theme_map() + 
  theme(legend.position = "right") + 
  labs(title = "Tons of Mid & Navel Oranges Produced in 2017 by State") 
  
  
  
  

```




















